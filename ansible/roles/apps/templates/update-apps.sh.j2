#!/bin/bash
# Script de actualizaciÃ³n rÃ¡pida de aplicaciones
# Generado automÃ¡ticamente por Ansible

set -e

echo "ï¿½ Actualizando aplicaciones Executive Service Business..."

cd {{ app_directory }}

# Actualizar cÃ³digo desde Git
echo "ï¿½ Actualizando cÃ³digo desde Git..."
git pull origin {{ git_branch }}

# Instalar dependencias si hay cambios
echo "ğŸ“¦ Verificando dependencias..."
npm install

# Actualizar dependencias de las aplicaciones
cd apps/corporativa
npm install
cd ../eyenga
npm install
cd ../..

# Compilar aplicaciones
echo "ğŸ—ï¸  Compilando aplicaciones..."
cd apps/corporativa
npm run build
cd ../eyenga
npm run build
cd ../..

# Reiniciar aplicaciones con PM2
echo "ğŸ”„ Reiniciando aplicaciones..."
pm2 restart all

echo "âœ… ActualizaciÃ³n completada!"
echo ""
echo "ğŸŒ URLs de acceso:"
echo "   â€¢ https://{{ corporativa_domain }}"
echo "   â€¢ https://{{ eyenga_domain }}"
echo ""
echo "ğŸ“Š Estado de aplicaciones:"
pm2 list
